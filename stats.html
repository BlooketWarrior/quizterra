<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quizterra | Stats</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(120deg, #47a7ff, #745cff, #ff4ef2);
      background-size: 400% 400%;
      animation: gradientMove 10s ease infinite;
      min-height: 100vh;
      text-align: center;
      padding-top: 50px;
      color: white;
    }
    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .stats-card {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(8px);
      width: 480px;
      margin: auto;
      margin-top: 20px;
      padding: 35px;
      border-radius: 25px;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      animation: fadeIn 1s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .profile-img {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      border: 5px solid white;
      margin-bottom: 20px;
    }

    .xp-container {
      width: 100%;
      height: 25px;
      background: rgba(255,255,255,0.3);
      border-radius: 20px;
      margin-top: 15px;
      overflow: hidden;
    }

    .xp-fill {
      height: 100%;
      background: #00ffea;
      width: 0%;
      transition: width 1.2s ease;
    }

    .badge-list {
      margin-top: 20px;
    }

    .badge {
      display: inline-block;
      background: white;
      color: #222;
      padding: 8px 16px;
      border-radius: 15px;
      margin: 5px;
      font-weight: 600;
      font-size: 16px;
    }

    .edit-btn, .logout-btn {
      margin-top: 25px;
      background: white;
      color: #222;
      padding: 14px 32px;
      border-radius: 50px;
      font-size: 20px;
      border: none;
      cursor: pointer;
      font-weight: 700;
      transition: 0.25s;
    }
    button:hover {
      transform: scale(1.07);
    }

    #editPopup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      color: black;
      padding: 30px;
      border-radius: 25px;
      width: 380px;
      display: none;
      text-align: center;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }

    .avatar-select img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      margin: 8px;
      cursor: pointer;
      border: 3px solid transparent;
      transition: 0.2s;
    }
    .avatar-select img:hover {
      transform: scale(1.1);
    }
  </style>
</head>
<body>

<h1>Your Quizterra Stats</h1>
<p>Welcome back, adventurer!</p>

<div class="stats-card">

  <img id="userPic" class="profile-img" src="" alt="Profile">

  <h2 id="userName"></h2>
  <h3 id="usernameDisplay" style="opacity:0.9; font-weight:600; margin-top:-10px;"></h3>

  <p id="userEmail"></p>

  <!-- XP / LEVEL -->
  <h2>Level <span id="levelNum">1</span></h2>
  <div class="xp-container">
    <div class="xp-fill" id="xpFill"></div>
  </div>
  <p><span id="xpNow">0</span> / <span id="xpReq">100</span> XP</p>

  <!-- Daily STREAK -->
  <h2>ðŸ”¥ Daily Streak: <span id="streakNum">1</span> days</h2>

  <!-- Stats -->
  <div class="stat-label">Games Played: <span id="gamesPlayed">0</span></div>
  <div class="stat-label">Correct Answers: <span id="correctAnswers">0</span></div>
  <div class="stat-label">Total Points: <span id="totalPoints">0</span></div>

  <!-- Badges -->
  <h2>Badges</h2>
  <div class="badge-list" id="badgeList"></div>

  <button class="edit-btn" onclick="openEdit()">Edit Profile</button>
  <button class="logout-btn" onclick="logout()">Log Out</button>
</div>

<!-- Popup for Editing Profile -->
<div id="editPopup">
  <h2>Edit Profile</h2>

  <p>Change Username (10 letters only)</p>
  <input id="newUsername" maxlength="10" style="padding:10px; width:80%; font-size:18px;">

  <p style="margin-top:15px;">Choose Avatar</p>
  <div class="avatar-select" id="avatarSelection"></div>

  <button onclick="saveProfile()" style="margin-top:20px;">Save</button>
  <button onclick="closeEdit()" style="margin-top:10px;">Cancel</button>
</div>

<script>
  const user = JSON.parse(localStorage.getItem("quizterraUser"));
  const stats = JSON.parse(localStorage.getItem("quizterraStats")) || {
    gamesPlayed: 24,
    correctAnswers: 60,
    totalPoints: 450,
    xp: 120,
    level: 2,
    streak: 1
  };

  if (!user) window.location.href = "signup.html";

  // Insert user info
  document.getElementById("userPic").src = user.picture;
  document.getElementById("userName").textContent = user.name;
  document.getElementById("usernameDisplay").textContent = "@" + user.username;
  document.getElementById("userEmail").textContent = user.email;

  // INSERT STATS
  animateNumber("gamesPlayed", stats.gamesPlayed);
  animateNumber("correctAnswers", stats.correctAnswers);
  animateNumber("totalPoints", stats.totalPoints);

  // LEVEL + XP SYSTEM
  const level = stats.level;
  const xp = stats.xp;
  const xpRequired = 100 + (level - 1) * 50;

  document.getElementById("levelNum").textContent = level;
  document.getElementById("xpNow").textContent = xp;
  document.getElementById("xpReq").textContent = xpRequired;

  const xpPercent = Math.min((xp / xpRequired) * 100, 100);
  setTimeout(() => {
    document.getElementById("xpFill").style.width = xpPercent + "%";
  }, 300);

  // DAILY STREAK
  animateNumber("streakNum", stats.streak);

  // BADGES
  const badgeList = document.getElementById("badgeList");
  const badgeData = [
    { name: "ðŸŽ¯ 50 Correct Answers", condition: stats.correctAnswers >= 50 },
    { name: "ðŸ† Played 20 Games", condition: stats.gamesPlayed >= 20 },
    { name: "ðŸ”¥ 3 Day Streak", condition: stats.streak >= 3 },
    { name: "ðŸ’Ž Level 5", condition: stats.level >= 5 },
  ];

  badgeData.forEach(b => {
    if (b.condition) {
      const badge = document.createElement("div");
      badge.className = "badge";
      badge.innerText = b.name;
      badgeList.appendChild(badge);
    }
  });

  // Animated number function
  function animateNumber(id, end) {
    let start = 0;
    const duration = 1000;
    const stepTime = Math.abs(Math.floor(duration / end));

    let obj = document.getElementById(id);
    let timer = setInterval(() => {
      start++;
      obj.textContent = start;
      if (start >= end) clearInterval(timer);
    }, stepTime);
  }

  // PROFILE EDITING
  function openEdit() { document.getElementById("editPopup").style.display = "block"; }
  function closeEdit() { document.getElementById("editPopup").style.display = "none"; }

  // AVATAR SELECTION LIST
  const avatarSelection = document.getElementById("avatarSelection");
  const avatars = [
    "https://i.imgur.com/6ZfKieD.png",
    "https://i.imgur.com/9R9jGud.png",
    "https://i.imgur.com/ziGZp8Z.png",
    "https://i.imgur.com/xW8J7cU.png"
  ];

  avatars.forEach(a => {
    let img = document.createElement("img");
    img.src = a;
    img.onclick = () => {
      user.picture = a;
      document.getElementById("userPic").src = a;
    };
    avatarSelection.appendChild(img);
  });

  // SAVE PROFILE CHANGES
  function saveProfile() {
    let newUsername = document.getElementById("newUsername").value;

    if (!/^[A-Za-z]{10}$/.test(newUsername)) {
      alert("Username must be EXACTLY 10 letters.");
      return;
    }

    user.username = newUsername;
    localStorage.setItem("quizterraUser", JSON.stringify(user));

    document.getElementById("usernameDisplay").textContent = "@" + newUsername;
    closeEdit();
  }

  function logout() {
    localStorage.removeItem("quizterraUser");
    window.location.href = "signup.html";
  }
</script>

</body>
</html>
